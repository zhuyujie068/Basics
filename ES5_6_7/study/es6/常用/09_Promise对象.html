<!-- <!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>11_Promise对象</title>
</head>

<body>
  <!--
1. 理解:
  * Promise对象: 代表了未来某个将要发生的事件(通常是一个异步操作)
  * 有了promise对象, 可以将异步操作以同步的流程表达出来, 避免了层层嵌套的回调函数(俗称'回调地狱')
  * ES6的Promise是一个构造函数, 用来生成promise实例

2. 使用promise基本步骤(2步):
  * 创建promise对象
    let promise = new Promise((resolve, reject) => {
        //初始化promise状态为 pending
      //执行异步操作
      if(异步操作成功) {
        resolve(value);//修改promise的状态为fullfilled
      } else {
        reject(errMsg);//修改promise的状态为rejected
      }
    })
  * 调用promise的then()
    promise.then(function(
      result => console.log(result),
      errorMsg => alert(errorMsg)
    ))

3. promise对象的3个状态
  * pending: 初始化状态
  * fullfilled: 成功状态
  * rejected: 失败状态

4. 应用:
  * 使用promise实现超时处理

  * 使用promise封装处理ajax请求
    let request = new XMLHttpRequest();
    request.onreadystatechange = function () {
    }
    request.responseType = 'json';
    request.open("GET", url);
    request.send();
-->

<script type="text/javascript">

  // 创建 promise 对象
  let promise = new Promise((resolve, reject) => {  // resolve,reject 这两个参数是函数

    // 初始化 promise   状态:pending:初始化
    console.log('111');

    setTimeout(() => {
      console.log('333');

      // 根据异步任务的返回结果来去修改 promise 的状态

      // 异步任务执行成功
      // resolve(data);  // 调用 resolve 会修改 promise 的状态为 fullfilled : 成功的状态

      // 异步任务执行失败
      reject(error); // 调用 reject 会修改 promise 的状态为 rejected: 失败状态

    }, 2000)
  })
  console.log('222');

  promise.then(
    (data) => { //成功的回调
      console.log('成功了。。。')
    },
    (error) => { // 失败的回调
      console.log('失败了。。。')
    });


  // 定义获取新闻的功能函数
  function getNews(url) {
    let promise = new Promise((resolve, reject) => {
      // 状态：初始化
      // 执行异步任务
      // 创建 xmlHttp ss实例对象
      let xmlHttp = new XMLHttpRequest();

      // 绑定监听 readyState
      xmlHttp.onreadystatechange = function () { // 此函数会被调用 4 次 （ 状态码从 0-->1 ,1-->2,2-->3,3-->4 ）
        if (xmlHttp.readyState == 4) {
          if (xmlHttp.status == 200) { //请求成功
            console.log(xmlHttp.responseText);
            // 修改状态
            resolve(xmlHttp.responseText); // 修改promise的状态为成功状态
          } else {  // 请求失败
            reject('请求失败，没有获取到数据'); // 修改promise的状态为失败状态
          }
        }
      };

      // open 设置请求的方式以及url
      xmlHttp.open('GET', url);

      // 发送
      xmlHttp.send();

    });
    return promise;
  };

  getNews('http://').then((data) => {
    console.log(data);
  }, (error) => {
    console.log(error);
  });

</script>

</body>

</html> -->